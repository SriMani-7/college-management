<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin dashboard</title>
    <link rel="stylesheet" href="../boostrap/bootstrap.min.css" />
  </head>

  <body>
    <header class="bg-light mb-3">
      <nav class="navbar navbar-light p-2">
        <a class="navbar-brand" href="/admin/dashboard">Admin Dashboard</a>
        <ul class="nav justify-content-end">
          <a class="nav-link" href="/admin/dashboard.html?nav=courses"
            >Courses</a
          >
          <a class="nav-link" href="/admin/dashboard.html?nav=faculties"
            >Faculties</a
          >
          <a class="nav-link" href="/admin/dashboard.html?nav=students"
            >Students</a
          >
          <a class="nav-link" href="#">Logout</a>
        </ul>
      </nav>
    </header>

    <div class="p-3 container-fluid" id="courses-panel">
      <div class="container-fluid">
        <div class="mb-2">
          <h5>Available courses</h5>
          <button
            class="btn btn-outline-primary m-2"
            data-bs-toggle="modal"
            data-bs-target="#newCourseModal"
          >
            Add new course
          </button>
        </div>
      </div>
      <div class="row" id="courses-list"></div>
    </div>

    <div class="p-3 card" id="faculties-panel">
      <table class="table-responsive card-body container">
        <tr class="thead-light">
          <th scope="col">Joining date</th>
          <th scope="col">First name</th>
          <th scope="col">Last name</th>
          <th scope="col">Course</th>
          <th scope="col">City</th>
          <th scope="col">Mobile number</th>
          <th scope="col">Email</th>
        </tr>
        <tbody id="faculties-host"></tbody>
      </table>
    </div>

    <div id="students-panel">
      <div id="students-host"></div>
    </div>

    <script src="../boostrap/bootstrap.min.js"></script>
    <script src="../util.js"></script>
    <script src="../rest.js"></script>
    <script src="../forms.js"></script>
    <script>
      const coursesHost = document.querySelector("#courses-list");
      const facultiesHost = document.querySelector("#faculties-host");
      const studentsHost = document.querySelector("#students-host");

      window.addEventListener("load", () => {
        const navParameter = getNavParameter();
        handleNavigation(navParameter);
      });

      function handleNavigation(nav) {
        const coursesPanel = document.querySelector("#courses-panel");
        const facultiesPanel = document.querySelector("#faculties-panel");
        const studentsPanel = document.querySelector("#students-panel");

        coursesPanel.style.display = "none";
        facultiesPanel.style.display = "none";
        studentsPanel.style.display = "none";

        if (nav === "courses") {
          loadCourses();
          coursesPanel.style.display = "block";
        } else if (nav === "faculties") {
          loadFaculties();
          facultiesPanel.style.display = "block";
        } else if (nav === "students") {
          loadStudents();
          studentsPanel.style.display = "block";
        }
      }

      function getNavParameter() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("nav");
      }

      async function loadCourses() {
        let courses = await get("/api/courses");
        coursesHost.innerHTML = "";
        courses.forEach((course) => {
          coursesHost.innerHTML += `
            <div class="card m-2" style="width: 18rem;">
              <div class="card-body">
                <h5 class="card-title">${course.name}</h5>
                <h6 class="card-subtitle mb-2 text-muted">${course.shortName}</h6>
                <p class="card-text">${course.description}</p>
                <a class="card-link" href="/admin/courses.html?courseId=${course.id}">Open</a>
              </div>
            </div>`;
        });
      }

      async function loadFaculties() {
        const response = await fetch("/api/faculty");
        const faculties = await response.json();
        facultiesHost.innerHTML = "";
        faculties.forEach((faculty) => {
          facultiesHost.innerHTML += `
            <tr>
              <td>${faculty.joiningDate}</td>
              <td>${faculty.firstName}</td>
              <td>${faculty.lastName}</td>
              <td>${faculty.course.name}</td>
              <td>${faculty.contactDetails.city}</td>
              <td>${faculty.contactDetails.mobileNumber}</td>
              <td>${faculty.contactDetails.email}</td>
            </tr>`;
        });
      }

      async function loadStudents() {
        // Implementation for loading students
      }

      async function addCourse(event) {
        event.preventDefault();
        const form = event.target;

        if (!form.checkValidity()) {
          event.stopPropagation();
          form.classList.add("was-validated");
        } else {
          
          const response = await postForm("/api/courses", form);
          if (response.status === 200) {
            loadCourses();
          } else if (response.status === 500) {
            const errorLabel = document.getElementById("errorLabel");
            const json = await response.text();
            errorLabel.textContent = json;
          }
        }
      }

      const newCourseModal = createModal(
        "newCourseModal",
        "New Course",
        newCourseForm.outerHTML
      );

      document.body.append(newCourseModal);
    </script>
  </body>
</html>
